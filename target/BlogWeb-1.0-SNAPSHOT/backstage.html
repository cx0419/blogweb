<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/Bootstrap.css">
    <link rel="stylesheet" href="css/headnav.css">
    <link rel="stylesheet" href="css/backstage.css">
    <link rel="stylesheet" href="iconfont/iconfont.css">
    <link rel="stylesheet" href="css/fenye.css">
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/axios-0.18.0.min.js"></script>
    <script src="js/axiosUtil.js"></script>
    <script src="js/loadnav.js"></script>
    <script src="js/fenye.js"></script>
</head>
<body>
<div class="backpage-title">BlogWeb后台管理系统</div>
<div style="height: 100%;min-height: 1500px">
        <div class="nav">
            <div class="nav-top">
                <div id="mini" style="border-bottom:1px solid rgba(255,255,255,.1)"><span style="color: white;font-size: 30px" class="iconfont">&#xe790;</span></div>
            </div>
            <ul id="aat">

            </ul>
        </div>
        <div style="margin-top: 80px;" class="backcontent">
            <div class="home">

            </div>
            <div id="deleteuser" class="delteuser">
                <h3>当前位置：用户管理删除</h3>
                <table class="table table-hover text-center">
                    <tbody id="userlist" class="userlist">
                    <tr>
                        <th width="5%">ID</th>
                        <th width="10%">账号</th>
                        <th width="10%">用户名</th>
                        <th width="10%">头像</th>
                        <th width="25%">简介</th>
                        <th width="15%">账号创建时间</th>
                        <th width="20%">操作</th>
                    </tr>
                    <tr>
                        <td >1</td>
                        <td>123456789</td>
                        <td>程序员</td>
                        <td width="10%"><img src="https://tenfei03.cfp.cn/creative/vcg/nowarter800/new/VCG41N1169250112.jpg?x-oss-process=image/format,webp" alt="" width="70" height="50"></td>
                        <td>这个人很懒什么都没有留下~</td>
                        <td>2020-01-01</td>
                        <td><div><a id="usercheck" href=""> 查看</a><a id="useralter" href=""> 修改</a> <a style="color: red" id="userdelte" href=""> 删除</a></div></td>
                    </tr>
                    </tbody>
                </table>
                <div class="page_1"></div>
            </div>
            <div id="examineblog" class="examineblog">
                <h3>当前位置：博客审核</h3>
                <table class="table table-hover text-center">
                    <tbody id="Blogexaminelist" class="userlist">
                    <tr>
                        <th width="5%">ID</th>
                        <th width="10%">博客作者id</th>
                        <th width="10%">博客封面</th>
                        <th width="10%">博客标题</th>
                        <th width="30%">博客简介</th>
                        <th width="15%">博客发布时间</th>
                        <th width="20%">操作</th>
                    </tr>
                    <tr>
                        <td >1</td>
                        <td>3</td>
                        <td width="10%"><img src="https://tenfei03.cfp.cn/creative/vcg/nowarter800/new/VCG41N1169250112.jpg?x-oss-process=image/format,webp" alt="" width="70" height="50"></td>
                        <td>java</td>
                        <td>我是博客简介</td>
                        <td>2020-01-01</td>
                        <td><div><a  href=""> 查看</a><a  href=""> 通过</a><a  href=""> 不通过</a></div></td>
                    </tr>
                    </tbody>
                </table>
                <div class="page_2"></div>
            </div>
            <div id="deleteblog" class="deleteblog">
                <h3>当前位置：博客删除</h3>
                <table class="table table-hover text-center">
                    <tbody id="Blogedeletelist" class="userlist">
                    <tr>
                        <th width="5%">ID</th>
                        <th width="10%">博客作者id</th>
                        <th width="10%">博客封面</th>
                        <th width="10%">博客标题</th>
                        <th width="30%">博客简介</th>
                        <th width="15%">博客发布时间</th>
                        <th width="20%">操作</th>
                    </tr>
                    <tr>
                        <td >1</td>
                        <td>3</td>
                        <td width="10%"><img src="https://tenfei03.cfp.cn/creative/vcg/nowarter800/new/VCG41N1169250112.jpg?x-oss-process=image/format,webp" alt="" width="70" height="50"></td>
                        <td>java</td>
                        <td>我是博客简介</td>
                        <td>2020-01-01</td>
                        <td><div><a  href=""> 查看</a><a  href=""> 删除</a></div></td>
                    </tr>
                    </tbody>
                </table>
                <div class="page_2"></div>
            </div>
            <div id="recommendblog" class="recommendblog">
                <h3>当前位置：推荐管理</h3>
                <table class="table table-hover text-center">
                    <tbody id="BlogeRecommendlist" class="userlist">
                    <tr>
                        <th width="5%">ID</th>
                        <th width="10%">博客作者id</th>
                        <th width="10%">博客封面</th>
                        <th width="10%">博客标题</th>
                        <th width="30%">博客简介</th>
                        <th width="15%">博客发布时间</th>
                        <th width="20%">操作</th>
                    </tr>
                    <tr>
                        <td >1</td>
                        <td>3</td>
                        <td width="10%"><img src="https://tenfei03.cfp.cn/creative/vcg/nowarter800/new/VCG41N1169250112.jpg?x-oss-process=image/format,webp" alt="" width="70" height="50"></td>
                        <td>java</td>
                        <td>我是博客简介</td>
                        <td>2020-01-01</td>
                        <td><div><a  href=""> 查看</a><a  href=""> 删除</a></div></td>
                    </tr>
                    </tbody>
                </table>
                <div class="page_2"></div>
            </div>
        </div>

</div>
<script>
    function closeAll(){
        let list = document.getElementsByClassName('page_2');
        let rel  = [];
        let i;

        for (i = 0; i < list.length; ++i)
        {
            list[i].innerHTML = "";
        }
        $("#deleteuser").css("display","none");
        $("#examineblog").css("display","none");
        $("#deleteblog").css("display","none");
        $('#recommendblog').css('display','none');
    }
    function oepndeleteuser(){
        closeAll();
        $("#deleteuser").css("display","block");
        function userlist(num) {
            console.log("num:"+num);
            AxiosPostRequst("http://localhost:8080/BlogWeb/AttentionServlet?method=getUsersByKey", {
                'pagenum': num,
                'key':''
            }).then(res => {
                let str0 = "            <tr>\n" +
                    "                <th width=\"5%\">ID</th>\n" +
                    "                <th width=\"10%\">博客作者id</th>\n" +
                    "                <th width=\"10%\">博客作者</th>\n" +
                    "                <th width=\"10%\">博客标题</th>\n" +
                    "                <th width=\"30%\">博客简介</th>\n" +
                    "                <th width=\"15%\">博客发布时间</th>\n" +
                    "                <th width=\"20%\">操作</th>\n" +
                    "            </tr>";
                document.getElementById("userlist").innerHTML = "";
                let div = document.createElement('tr');
                //div.classList.add("fansunit");
                div.innerHTML = str0;
                $('#userlist').append(div);
                let page = res.page;
                let pageSize = page.pageSize;
                let pageNum = page.pageNum;
                let pages = page.pages;
                let total = page.total;
                let users = page.data;
                for(let i = 0 ; i < users.length ; i++){
                    let userForFocus = users[i];
                    let user = userForFocus.user;
                    let avatar = user.avatar;
                    if(user.avatar===undefined){
                        avatar = "https://profile.csdnimg.cn/3/D/A/1_seventy70";
                    }
                    let checkbtn = "useralter"+user.id;
                    let useralter = "useralter"+user.id;
                    let userdelte = "userdelte"+user.id;


                    // 给div里面加li
                    let str1 = "               <td >"+user.id+"</td>\n" +
                        "                <td>"+user.account+"</td>\n" +
                        "                <td>"+user.name+"</td>\n" +
                        "                <td width=\"10%\"><img src=\""+user.avatar+"\" alt=\"\" width=\"60\" height=\"50\"></td>\n" +
                        "                <td>"+user.introduction+"</td>\n" +
                        "                <td>"+user.createTime.substr(0,10)+"</td>\n" +
                        "                <td><div><a id=\""+checkbtn+"\" href=\"#\"> 查看</a><a id=\""+useralter+"\" href=\"#\"> 修改</a> <a style=\"color: red\" id=\""+userdelte+"\" href=\"#\"> 删除</a></div></td>";
                    let div = document.createElement('tr');
                    //div.classList.add("fansunit");
                    div.innerHTML = str1;
                    $('#userlist').append(div);
                    $('#'+checkbtn).on('click', e => {
                        window.open("http://localhost:8080/BlogWeb/person.html?id="+user.id);
                    });
                    $('#'+useralter).on('click', e => {
                        window.open("http://localhost:8080/BlogWeb/personalCenter.html?page=person&id="+user.id);
                    });
                    $('#'+userdelte).on('click', e => {
                        AxiosPostRequst("http://localhost:8080/BlogWeb/UserServlet/deleteUser", {
                            'id': user.id
                        }).then(res => {
                            console.log(res.msg);
                        });
                        let json = {
                            'bloggerId': user.id,
                            'fansId': getCookie("id")
                        }
                    })
                }
            });
        }
        //初始化页数
        AxiosPostRequst("http://localhost:8080/BlogWeb/AttentionServlet?method=getUsersByKey", {
            'key': "",
            'pagenum': 1
        }).then(res => {
            let page = res.page;
            let pageSize = page.pageSize;
            let pageNum = page.pageNum;
            let pages = page.pages;
            let total = page.total;
            let user = page.data;
            let obj_2 = {
                obj_box: '.page_1',//翻页容器
                total_item: total,//条目总数
                per_num: 10,//每页条目数
                current_page: pageNum//当前页
            };
            page_ctrl(obj_2,userlist);
        });

    }
    function oepnexamineblog(){
        closeAll();
        $("#examineblog").css("display","block");
        function shenghelist(num) {
            AxiosPostRequst("http://localhost:8080/BlogWeb/BlogServlet?method=selectNoExamineBlogs", {
                'pagenum': num,
            }).then(res => {
                let str0 = "                <th width=\"5%\">ID</th>\n" +
                    "                <th width=\"10%\">博客作者id</th>\n" +
                    "                <th width=\"10%\">博客封面</th>\n" +
                    "                <th width=\"10%\">博客标题</th>\n" +
                    "                <th width=\"30%\">博客简介</th>\n" +
                    "                <th width=\"15%\">博客发布时间</th>\n" +
                    "                <th width=\"20%\">操作</th>";
                document.getElementById("Blogexaminelist").innerHTML = "";
                let div = document.createElement('tr');
                //div.classList.add("fansunit");
                div.innerHTML = str0;
                $('#Blogexaminelist').append(div);
                let page = res.page;
                let pageSize = page.pageSize;
                let pageNum = page.pageNum;
                let pages = page.pages;
                let total = page.total;
                let blogs = page.data;
                for(let i = 0 ; i < blogs.length ; i++){
                    let blog = blogs[i];
                    if(blog.firstPicture===undefined){
                        avatar = "https://profile.csdnimg.cn/3/D/A/1_seventy70";
                    }
                    let checkbtn = "checkbtn"+blog.id;
                    let passtbn = "passtbn"+blog.id;
                    let nopasstbtn = "nopasstbtn"+blog.id;


                    // 给div里面加li
                    let str1 = "                <td >"+blog.id+"</td>\n" +
                        "                <td>"+blog.userId+"</td>\n" +
                        "                <td width=\"10%\"><img src=\""+blog.firstPicture+"\" alt=\"\" width=\"70\" height=\"50\"></td>\n" +
                        "                <td>"+blog.title+"</td>\n" +
                        "                <td>"+blog.description+"</td>\n" +
                        "                <td>"+blog.createTime.substr(0,10)+"</td>\n" +
                        "                <td><div><a id=\""+checkbtn+"\" href=\"#\"> 查看</a><a id=\""+passtbn+"\" href=\"#\"> 通过</a></div></a><a id=\""+nopasstbtn+"\" href=\"#\"> 不通过</a></div></td>";
                    let div = document.createElement('tr');
                    //div.classList.add("fansunit");
                    div.innerHTML = str1;
                    $('#Blogexaminelist').append(div);
                    $('#'+checkbtn).on('click', e => {
                        window.open("http://localhost:8080/BlogWeb/blogPage.html?articleid="+blog.id);
                    });
                    $('#'+passtbn).on('click', e => {
                        AxiosPostRequst("http://localhost:8080/BlogWeb/BlogServlet?method=PassBlog", {
                            'id': blog.id
                        }).then(res => {
                            popSucceedWindows("已经将该文章审核通过")

                            console.log(res.msg);
                        });
                    });
                    $('#'+nopasstbtn).on('click', e => {
                        AxiosPostRequst("http://localhost:8080/BlogWeb/BlogServlet?method=nopassBlog", {
                            'id': blog.id
                        }).then(res => {
                            popSucceedWindows("该文章已经设置为不通过")
                            console.log(res.msg);
                        });
                    })
                }
            });
        }
        //初始化页数
        AxiosPostRequst("http://localhost:8080/BlogWeb/BlogServlet?method=selectNoExamineBlogs", {
            'pagenum': 1
        }).then(res => {
            let page = res.page;
            let pageSize = page.pageSize;
            let pageNum = page.pageNum;
            let pages = page.pages;
            let total = page.total;
            let blogs = page.data;
            let obj_2 = {
                obj_box: '.page_2',//翻页容器
                total_item: total,//条目总数
                per_num: 10,//每页条目数
                current_page: pageNum//当前页
            };
            page_ctrl(obj_2,shenghelist);
        });

    }

    function opendeleteblog() {
        closeAll();
        $("#deleteblog").css("display", "block");
        function deleteBlogf(num) {
            AxiosPostRequst("http://localhost:8080/BlogWeb/BlogServlet?method=selectBlogByKey", {
                'pagenum': num,
                'key': ''
            }).then(res => {
                let str0 = "                <th width=\"5%\">ID</th>\n" +
                    "                <th width=\"10%\">博客作者id</th>\n" +
                    "                <th width=\"10%\">博客封面</th>\n" +
                    "                <th width=\"10%\">博客标题</th>\n" +
                    "                <th width=\"30%\">博客简介</th>\n" +
                    "                <th width=\"15%\">博客发布时间</th>\n" +
                    "                <th width=\"20%\">操作</th>";
                document.getElementById("Blogedeletelist").innerHTML = "";
                let div = document.createElement('tr');
                //div.classList.add("fansunit");
                div.innerHTML = str0;
                $('#Blogedeletelist').append(div);
                let page = res.page;
                let pageSize = page.pageSize;
                let pageNum = page.pageNum;
                let pages = page.pages;
                let total = page.total;
                let blogs = page.data;
                for (let i = 0; i < blogs.length; i++) {
                    let blog = blogs[i];
                    if (blog.firstPicture === undefined) {
                        avatar = "https://profile.csdnimg.cn/3/D/A/1_seventy70";
                    }
                    let checkbtn = "checkbtn" + blog.id;
                    let deletebtn = "deletebtn" + blog.id;


                    // 给div里面加li
                    let str1 = "                <td >" + blog.id + "</td>\n" +
                        "                <td>" + blog.userId + "</td>\n" +
                        "                <td width=\"10%\"><img src=\"" + blog.firstPicture + "\" alt=\"\" width=\"70\" height=\"50\"></td>\n" +
                        "                <td>" + blog.title + "</td>\n" +
                        "                <td>" + blog.description + "</td>\n" +
                        "                <td>" + blog.createTime.substr(0, 10) + "</td>\n" +
                        "                <td><div><a id=\"" + checkbtn + "\" href=\"#\"> 查看</a><a id=\"" + deletebtn + "\" href=\"#\"> 删除</a></div></div></td>";
                    let div = document.createElement('tr');
                    //div.classList.add("fansunit");
                    div.innerHTML = str1;
                    $('#Blogedeletelist').append(div);
                    $('#' + checkbtn).on('click', e => {
                        window.open("http://localhost:8080/BlogWeb/blogPage.html?articleid=" + blog.id);
                    });
                    $('#' + deletebtn).on('click', e => {
                        AxiosPostRequst("http://localhost:8080/BlogWeb//BlogServlet?method=deleteBlogById", {
                            'id': user.id
                        }).then(res => {
                            console.log(res.msg);
                        });
                    });
                }
            });
        }

        //初始化页数
        AxiosPostRequst("http://localhost:8080/BlogWeb/BlogServlet?method=selectBlogByKey", {
            'key': "",
            'pagenum': 1
        }).then(res => {
            let page = res.page;
            let pageSize = page.pageSize;
            let pageNum = page.pageNum;
            let pages = page.pages;
            let total = page.total;
            let blogs = page.data;
            let obj_2 = {
                obj_box: '.page_2',//翻页容器
                total_item: total,//条目总数
                per_num: 10,//每页条目数
                current_page: pageNum//当前页
            };
            page_ctrl(obj_2, deleteBlogf);
        });
    }
    function opencommendBlog(){
        closeAll();
        $("#recommendblog").css("display", "block");
        function opencommendBlog_f(num){
            AxiosPostRequst("http://localhost:8080/BlogWeb/RecommendServlet?method=getRecommendBlogs",{
                pagenum:num
            }).then(res=>{
                let page = res.page;
                let pageSize = page.pageSize;
                let pageNum = page.pageNum;
                let pages = page.pages;
                let total = page.total;
                let recommendForBlogs =  page.data;
                let str0 = "                <th width=\"5%\">ID</th>\n" +
                    "                <th width=\"10%\">博客作者id</th>\n" +
                    "                <th width=\"10%\">博客封面</th>\n" +
                    "                <th width=\"10%\">博客标题</th>\n" +
                    "                <th width=\"30%\">博客简介</th>\n" +
                    "                <th width=\"15%\">博客发布时间</th>\n" +
                    "                <th width=\"20%\">操作</th>";
                document.getElementById("BlogeRecommendlist").innerHTML = "";
                let div = document.createElement('tr');
                //div.classList.add("fansunit");
                div.innerHTML = str0;
                $('#BlogeRecommendlist').append(div);
                for (let i = 0 ; i < recommendForBlogs.length ; i++){
                    let blog = recommendForBlogs[i].blog;
                    let isRecommend = recommendForBlogs[i].recommend;
                    console.log(isRecommend);
                    let inf = isRecommend===true?"移除推荐":"设置推荐";
                    let alterbtn = 'alterbtn' +blog.id;
                    let str = "                <td >" + blog.id + "</td>\n" +
                        "                <td>" + blog.userId + "</td>\n" +
                        "                <td width=\"10%\"><img src=\"" + blog.firstPicture + "\" alt=\"\" width=\"70\" height=\"50\"></td>\n" +
                        "                <td>" + blog.title + "</td>\n" +
                        "                <td>" + blog.description + "</td>\n" +
                        "                <td>" + blog.createTime.substr(0, 10) + "</td>\n" +
                        "                <td><div><a id=\"" + alterbtn + "\" href=\"#\">"+inf+"</a></div></td>";
                    let div1 = document.createElement('tr');
                    div1.innerHTML = str;
                    $('#BlogeRecommendlist').append(div1);
                    if(isRecommend){
                        $('#'+alterbtn).css('color','#e75e5e');
                        document.getElementById(alterbtn).innerHTML = "移除推荐";
                    }else{
                        $('#'+alterbtn).css('color','#60e2e8');
                        document.getElementById(alterbtn).innerHTML = "设置推荐";
                    }
                    //设置5推荐时间
                    $('#'+alterbtn).on('click',e=>{
                        let temp = document.getElementById(alterbtn).innerHTML;
                        console.log(temp);
                        if(temp==="移除推荐"){
                            AxiosPostRequst("http://localhost:8080/BlogWeb/RecommendServlet?method=deleteBlogFromRecommendList",{
                                blogid:blog.id
                            }).then(res=>{
                                popSucceedWindows("移除成功");
                                console.log(res.msg);
                                document.getElementById(alterbtn).innerHTML = "设置推荐";
                                $('#'+alterbtn).css('color','#60e2e8');
                            })
                        }else if(temp==="设置推荐"){
                            AxiosPostRequst("http://localhost:8080/BlogWeb/RecommendServlet?method=addBlogToRecommendList",{
                                blogid:blog.id
                            }).then(res=>{
                                popSucceedWindows("设置成功");
                                console.log(res.msg);
                                document.getElementById(alterbtn).innerHTML = "移除推荐";
                                $('#'+alterbtn).css('color','#e75e5e');
                            })
                        }
                    })
                }
            });
        }
        AxiosPostRequst("http://localhost:8080/BlogWeb/RecommendServlet?method=getRecommendBlogs",{
            pagenum:1
        }).then(res=>{
            let page = res.page;
            let pageSize = page.pageSize;
            let pageNum = page.pageNum;
            let pages = page.pages;
            let total = page.total;
          //  document.getElementsByClassName('page_2')[0].innerHTML = "";
            let obj_2 = {
                obj_box: '.page_2',//翻页容器
                total_item: total,//条目总数
                per_num: 10,//每页条目数
                current_page: pageNum//当前页
            };
            page_ctrl(obj_2, opencommendBlog_f);
        })
    }

    // var obj_2={
    //     obj_box:'.page_2',//翻页容器
    //     total_item:372,//条目总数
    //     per_num:20,//每页条目数
    //     current_page:8//当前页
    // };
    // page_ctrl(obj_2,function (){});
    //左侧栏
    $(function(){
        var navList = [
            {
                "p" : "首页",
                "c" : []
            },
            {
                "p" : "用户管理",
                "c" : ["修改删除用户"]
            },
            {
                "p" : "博客管理",
                "c" : ["审核博客","删除博客"]
            },
            {
                "p" : "设置",
                "c" : ["博客推送"]
            }

        ]
        var navData = '';
        for(let i=0;i<navList.length;i++){
            let str;
            let id= [[],['deleteuser1'],['examineblog1','deleteblog1'],['recommendblog1']]
            if(i==0){
                str = "&#xf0175;";
            }else if(i==1){
                str = "&#xe8e9;";
            }else if(i==2){
                str="&#xe68e;"
            }else if(i==3){
                str="&#xe660;";
            }
            navData+= "<li class='nav-item'><a href='javascript:;'><span class='iconfont'>"+str+navList[i].p+"</span></a><ul>"
            for(let w=0;w<navList[i].c.length;w++){
                navData+="<li id=\""+id[i][w]+"\"><a href='javascript:;'><span>"+navList[i].c[w]+"</span></a></li>"
            }
            navData+="</ul></li>"
        }
        console.log(navData)
        $('#aat').html(navData)
    })
</script>
<script>

</script>
</body>
<script>
    $(function(){
        $('#deleteuser1').on('click',function (){
            oepndeleteuser();
        });
        $('#examineblog1').on('click',function (){
            oepnexamineblog();
        });
        $('#deleteblog1').on('click',function (){
            opendeleteblog();
        });
        $('#recommendblog1').on('click',function (){
            console.log("asd");
            opencommendBlog();
        })



        // nav收缩展开
        $('#aat').on('click','.nav-item>a',function(){
            if (!$('.nav').hasClass('nav-mini')) {
                if ($(this).next().css('display') == "none") {
                    //展开未展开
                    $('.nav-item').children('ul').slideUp(300);
                    $(this).next('ul').slideDown(300);
                    $(this).parent('li').addClass('nav-show').siblings('li').removeClass('nav-show');
                }else{
                    //收缩已展开
                    $(this).next('ul').slideUp(300);
                    $('.nav-item.nav-show').removeClass('nav-show');
                }
            }
        });
        // 标志点击样式
        $('#aat').on('click','.nav-item>ul>li',function(){
            $('.nav-item>ul>li').css('background','none')
            $(this).css('background','yellow')
//  	$(this).siblings().css('background','none')
        })
        //nav-mini切换
        $('#mini').on('click',function(){
            if (!$('.nav').hasClass('nav-mini')) {
                $('.nav-item.nav-show').removeClass('nav-show');
                $('.nav-item').children('ul').removeAttr('style');
                $('.nav').addClass('nav-mini');

            }else{
                $('.nav').removeClass('nav-mini');
            }
        });
    });
</script>
</body>
</html>